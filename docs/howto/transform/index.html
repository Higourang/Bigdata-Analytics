<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link rel="alternate" type="application/rss+xml" href="/comet-data-pipeline/blog/rss.xml" title="Quickly Build Optimized Big & Fast Data Pipelines Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/comet-data-pipeline/blog/atom.xml" title="Quickly Build Optimized Big & Fast Data Pipelines Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-196399711-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Quickly Build Optimized Big & Fast Data Pipelines" href="/comet-data-pipeline/opensearch.xml"><title data-react-helmet="true">Transform | Quickly Build Optimized Big &amp; Fast Data Pipelines</title><meta data-react-helmet="true" property="og:url" content="https://ebiznext.github.io/comet-data-pipeline/docs/howto/transform"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Transform | Quickly Build Optimized Big &amp; Fast Data Pipelines"><meta data-react-helmet="true" name="description" content="Once your data is ingested, you may start to expose insights by joining them and / or create meaningful aggregates."><meta data-react-helmet="true" property="og:description" content="Once your data is ingested, you may start to expose insights by joining them and / or create meaningful aggregates."><link data-react-helmet="true" rel="shortcut icon" href="/comet-data-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://ebiznext.github.io/comet-data-pipeline/docs/howto/transform"><link data-react-helmet="true" rel="alternate" href="https://ebiznext.github.io/comet-data-pipeline/docs/howto/transform" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://ebiznext.github.io/comet-data-pipeline/docs/howto/transform" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://IEP5P8HN5L-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/comet-data-pipeline/assets/css/styles.d7bfe00e.css">
<link rel="preload" href="/comet-data-pipeline/assets/js/runtime~main.3f3c7849.js" as="script">
<link rel="preload" href="/comet-data-pipeline/assets/js/main.5dc6cf1a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/comet-data-pipeline/"><img src="/comet-data-pipeline/img/comet.png" alt="Comet Data Pipeline" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/comet-data-pipeline/img/comet.png" alt="Comet Data Pipeline" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Comet Data Pipeline</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/comet-data-pipeline/docs/intro">Getting Started</a><a class="navbar__item navbar__link" href="/comet-data-pipeline/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ebiznext/comet-data-pipeline/releases/latest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-download-link header-icon-link" aria-label="Download"></a><a href="https://github.com/ebiznext/comet-data-pipeline" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link header-icon-link" aria-label="GitHub repository"></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/comet-data-pipeline/"><img src="/comet-data-pipeline/img/comet.png" alt="Comet Data Pipeline" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/comet-data-pipeline/img/comet.png" alt="Comet Data Pipeline" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Comet Data Pipeline</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/comet-data-pipeline/docs/intro">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/comet-data-pipeline/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/ebiznext/comet-data-pipeline/releases/latest" target="_blank" rel="noopener noreferrer" class="menu__link header-download-link header-icon-link" aria-label="Download"></a></li><li class="menu__list-item"><a href="https://github.com/ebiznext/comet-data-pipeline" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link header-icon-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/comet-data-pipeline/docs/intro">What is it ?</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/userguide/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/userguide/quickstart">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/userguide/sample">Example</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/reference/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/reference/environment">Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/reference/extract">Extract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/reference/load">Load</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/reference/transform">Transform</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">HOWTO</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/comet-data-pipeline/docs/howto/extract">Extract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/comet-data-pipeline/docs/howto/load">Load</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/comet-data-pipeline/docs/howto/transform">Transform</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Examples</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/examples/extract">Extract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/examples/load">Load</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/examples/transform">Transform</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Cloud Specific</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cloud/azure">Microsoft Azure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cloud/gcp">Google Cloud Platform</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cloud/aws">Amazon Web Services</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/import">import</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/bqload">bqload</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/esload">esload | index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/infer-schema">infer-schema</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/load">load | ingest</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/metrics">metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/parquet2csv">parquet2csv</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/cnxload">cnxload</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/xls2yml">xls2yml</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/ddl2yml">ddl2yml</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/extract">extract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/transform">transform | job</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/watch">watch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/kafkaload">kafkaload</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/yml2xls">yml2xls</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/cli/yml2gv">yml2gv</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comet-data-pipeline/docs/devguide/contribute">How to contribute</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Transform</h1></header><div class="markdown"><p>Once your data is ingested, you may start to expose insights by joining them and / or create meaningful aggregates.</p><p>In the example below, we join the <code>sellers</code> and <code>orders</code> tables to compute the total amount sold by each seller.</p><p>We want to do it on parquet files and on BigQuery. We need to create 2 env files, one for environment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="parquet-job"></a>Parquet Job<a class="hash-link" href="#parquet-job" title="Direct link to heading">#</a></h2><p>Create the <code>env.FS.comet.yml</code> file in the <code>metadata</code> folder as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">sink_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;FS&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Spark</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">sellers_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;FS:${root_path}/datasets/accepted/hr/sellers&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">orders_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;FS:${root_path}/datasets/accepted/sales/orders&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Create the YAML file that describe the job and name it <code>sellers_kpi.comet.yml</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">transform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> kpi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">views</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">sellers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;${sellers_view}&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">orders</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;${orders_view}&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">sql</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;select seller_email, sum(amount) as sum from sellers, orders where sellers.id = orders.seller_id group by sellers.seller_email&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> byseller</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">domain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sales_kpi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> byseller_kpi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> OVERWRITE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">area</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> business</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Before executing the job, we set the <code>COMET_ENV</code> variable to <code>FS</code> to make sure variables are instantiated correctly:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">COMET_ENV</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">FS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$SPARK_HOME</span><span class="token plain">/bin/spark-submit target/scala-2.12/comet-assembly-VERSION.jar job --name sellers_kpi</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="bigquery-job"></a>BigQuery Job<a class="hash-link" href="#bigquery-job" title="Direct link to heading">#</a></h2><p>To execute the same request on BigQuery, we need to create views on the BigQuery tables where data were ingested.
Create the <code>env.BQ.comet.yml</code> file in the <code>metadata</code> folder as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">sink_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;BQ&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> BQ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">sellers_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;BQ:select * from hr.sellers&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># or simply sellers_view: hr.sellers</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">orders_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;BQ:select * from sales.orders&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># or simply sellers_view: sales.orders</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Before executing the job, we set the <code>COMET_ENV</code> variable to <code>BQ</code> to make sure variables are instantiated correctly:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">COMET_ENV</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">BQ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$SPARK_HOME</span><span class="token plain">/bin/spark-submit target/scala-2.12/comet-assembly-VERSION.jar job --name sellers_kpi</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="externalize-sql-requests"></a>Externalize SQL Requests<a class="hash-link" href="#externalize-sql-requests" title="Direct link to heading">#</a></h2><p>Most of the time you may want to use your favorite SQL Deve env (I personally use Jetbrains IntelliJ / DataGrip).
You may externalize the SQL Code in a file named after the name of the job if you have only one task in the job file
or after the name and the task for each task in the job file.</p><p>Create a SQL File with the name <code>ki.byseller.sql</code> (or simply <code>ki.sql</code> since we have only one task in the job file)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> seller_email</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> sum </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> sellers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> orders </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> sellers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> orders</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">seller_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> sellers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">seller_email</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>And leave the task.sql field blank in the YAML file.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/ebiznext/comet-data-pipeline/edit/master/docs/docs/howto/transform.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/comet-data-pipeline/docs/howto/load"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Load</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/comet-data-pipeline/docs/examples/extract"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Extract Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#parquet-job" class="table-of-contents__link">Parquet Job</a></li><li><a href="#bigquery-job" class="table-of-contents__link">BigQuery Job</a></li><li><a href="#externalize-sql-requests" class="table-of-contents__link">Externalize SQL Requests</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/comet-data-pipeline/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/comet-data-pipeline" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://gitter.im/comet-data-pipeline/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a href="https://twitter.com/comet-data-pipeline" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/comet-data-pipeline/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ebiznext/comet-data-pipeline" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Comet Data Pipeline, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/comet-data-pipeline/assets/js/runtime~main.3f3c7849.js"></script>
<script src="/comet-data-pipeline/assets/js/main.5dc6cf1a.js"></script>
</body>
</html>